---
title: "Tarefa Aula 1 – Exploração de SNA em R"
date: "Novembro de 2019"
output: 
  word_document: 
    highlight: tango
    toc: yes
    reference_docx: word-styles-reference.docx
---

```{r setup_evaluation, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.pos =  "h")
knitr::opts_knit$set(root.dir = "./")

# loading markdown libraries
library(rmarkdown)
library(knitr)
library(flextable)
library(officer)

# loading basic libraries
library(dplyr)
library(lubridate)
library(stringr)
library(xlsx)

# loasing plot libraries
library(ggplot2)
library(ggpubr)

# loading libraries for SNA (Systems Network Architecture)
library(network)
library(sna)
library(rgl)
library(visNetwork)

# setting the seed up
set.seed(42)

# setting the encoding up
options(encoding = "UTF-8")

```

*******************************************************************************

# Alunos / ID (matrícula)

\  

- <a href="https://github.com/DanielFCampos"><img src="https://avatars2.githubusercontent.com/u/31582602?s=460&v=4" title="DanielFCampos" width="40" height="40"></a> [Daniel Campos](mailto:daniel.ferraz.campos@gmail.com) / A57635769
- <a href="https://github.com/ldaniel"><img src="https://avatars2.githubusercontent.com/u/205534?s=460&v=4" title="ldaniel" width="40" height="40"></a>  [Leandro Daniel](mailto:contato@leandrodaniel.com) / A57622988
- <a href="https://github.com/RodriGonca"><img src="https://avatars2.githubusercontent.com/u/50252438?s=460&v=4" title="RodriGonca" width="40" height="40"></a> [Rodrigo Goncalves](mailto:rodrigo.goncalves@me.com) / A57566093
- <a href="https://github.com/ygorlima1"><img src="https://avatars2.githubusercontent.com/u/52429828?s=460&v=4" title="ygorlima1" width="40" height="40"></a>  [Ygor Lima](mailto:ygor_redesocial@hotmail.com) / A57549661

\  

*******************************************************************************

# Enunciado (parte 1)

\  

- Explore as rotinas Exemplo Rede.R e Exemplo Rede Two Mode.R . Rode os códigos na plataforma R utilizando como base as tabelas Rede One Mode_Tarefa Aula 1_Berrini T1.xlsx e Rede Two Mode_Tarefa Aula 1_Berrini T1.xlsx. (atenção: não são as mesmas bases trabalhadas em sala). 

- Faça pequenas modificações na tabela e veja seus resultados.

- Inclua outras análises em seu código (usando as extensões sna, network ou igraph) e comente os resultados (seja criativo!).

- Compile as saídas dos códigos (conteúdo das variáveis, gráficos, tabelas) em um documento Word (usando o modelo deste documento) e comente seus resultados (principalmente as medidas de centralidade), análises, potenciais implicações gerenciais, etc, conforme discutido em sala na Aula 1.

\  

## Explorando as rotinas de exemplo para rede one mode

\  

Como primeiro passo para o exercício proposto, vamos carregar os dados da planilha Excel **Rede One Mode_Tarefa Aula 1_Berrini T1.xlsx**. Incialmente, removeremos a primeira coluna que possui os nomes dos nós e vamos atribui-la às linhas.

\  

```{r exploration_one_mode_1, echo = TRUE, out.width = '100%'}

# carregando a planilha com os dados do exercício
rede_one_mode <- read.xlsx("../../data/raw/Rede One Mode_Tarefa Aula 1_Berrini T1.xlsx", 
                           sheetName = "Exemplo Rede")

# removendo a coluna com os nomes dos nós
grede_one_mode <- rede_one_mode[,2:25]

# atribuindo o nome dos nós às linhas
rownames(grede_one_mode) <- rede_one_mode[,1]

```


\  

Podemos então, visualizar a rede sob a forma de um grafo.

\  

```{r plot_one_mode_1, echo = TRUE, out.width = '100%'}

gplot(grede_one_mode, 
      gmode = "graph", 
      displaylabels = TRUE, 
      edge.col = "gray", 
      usearrows = FALSE)

```


O **R** oferece várias packages para manipulação e geração de visualizações de redes. Abaixo, vemos um exemplo utilizando a library **igraph**.

\  

```{r plot_one_mode_2, echo = TRUE, out.width = '100%'}

g_one_mode <- igraph::graph_from_adjacency_matrix(as.matrix(grede_one_mode))

visIgraph(g_one_mode)

```

\  

A **SNA**, do inglês Systems Network Analysis (Análise de Sistemas de Redes), dispõe de um conjunto de métricas que auxiliam na compreensão da dinâmica dos relacionamentos existentes nas redes analisadas. Dentre elas, destacam-se as métricas de Centralidade (Centrality), que permitem a avaliação da importância de um nó (individuo/ação/postagem) dentro da rede. Na sequência, vamos explorar as métricas de centralidade: **degree**, **closeness** e **betweenness**.

\  

A **Centralidade de Grau** (Degree Centrality) representa o número de ligações que um nó possui (degree), dividido pelo número de ligações possíveis.

\  

Definimos como **Centralidade de Proximidade** (Closeness Centrality) a medida do comprimento médio dos caminhos mais curtos de um vértice para cada um dos outros vértices de um grafo.

\  

A chamada **Centralidade de Intermediação** (Betweenness Centrality) representa a quantidade de vezes que um determinado nó aparece no caminho geodésico entre dois nós da rede.

\  

A seguir, exploraremos as métricas de centralidade para a rede one mode.

\  

```{r exploration_metrics_one_mode_1, echo = TRUE, out.width = '100%'}

metricas_one_mode <- cbind(label = rownames(grede_one_mode),
                           degree = degree(grede_one_mode, gmode = "graph", cmode = "indegree"),
                           closeness = closeness(grede_one_mode, gmode = "graph"),
                           betweenness = betweenness(grede_one_mode, gmode = "graph"))

table_output <- flextable(as.data.frame(metricas_one_mode))
table_output <- fontsize(table_output, part = "all", size = 8)
table_output <- autofit(table_output)
table_output

```

\  

## Aplicando modificações na rede one mode e analisando os resultados

\  

To-do

\  

## Explorando as rotinas de exemplo para rede two mode

\  

Como primeiro passo para o exercício proposto, vamos carregar os dados da planilha Excel **Rede Two Mode_Tarefa Aula 1_Berrini T1.xlsx**. Faremos um tratamento semelhante ao realizado para a rede anterior.

\  

```{r exploration_one_mode_1, echo = TRUE, out.width = '100%'}

# carregando a planilha com os dados do exercício
rede_two_mode <- read.xlsx("../../data/raw/Rede Two Mode_Tarefa Aula 1_Berrini T1.xlsx", 
                           sheetName = "Rede 2-mode")

# removendo a coluna com os nomes dos nós
grede_two_mode <- rede_two_mode[,2:15]

# atribuindo o nome dos nós às linhas
rownames(grede_two_mode) <- rede_two_mode[,1]

```


\  

Visualizando a rede sob a forma de um grafo.

\  

```{r plot_one_mode_1, echo = TRUE, out.width = '100%'}

gplot(grede_two_mode, gmode = "twomode", 
      displaylabels = TRUE,
      edge.col = "gray", 
      label.cex = 0.7, 
      usearrows = FALSE)

```

\  

A seguir, exploraremos as métricas de centralidade para a rede two mode.

\  

```{r exploration_metrics_one_mode_1, echo = TRUE, out.width = '100%'}

metricas_two_mode <- cbind(label = rownames(grede_two_mode),
                           degree = degree(grede_two_mode, gmode = "twomode", cmode = "indegree"),
                           closeness = closeness(grede_two_mode, gmode = "twomode"),
                           betweenness = betweenness(grede_two_mode, gmode = "twomode"))

table_output <- flextable(as.data.frame(metricas_two_mode))
table_output <- fontsize(table_output, part = "all", size = 8)
table_output <- autofit(table_output)
table_output

```

\  

*******************************************************************************

# Enunciado (parte 2)

\  

- **Desafio:** Baseado na tabela da Rede Two Mode desta tarefa, faça uma análise de agrupamento (cluster analysis) do tipo hierárquico aglomerativo (dendrograma) das pessoas ou dos produtos adquiridos por elas, levando em consideração apenas a estrutura de relações entre elas. Comente como implementou e discuta os resultados, comparando com a rede construída. Utilize a plataforma R e o script de exemplo de uso de Cluster Analysis em R.

\  

*Dica: após a seleção dos grupos, desenhe a rede e represente os nós das pessoas (ou produtos) com cores de acordo com o grupo correspondente.*